<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `MessageStream` struct in crate `capnp_nonblock`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, MessageStream">

    <title>capnp_nonblock::MessageStream - Rust</title>

    <link rel="stylesheet" type="text/css" href="../main.css">

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'><a href='index.html'>capnp_nonblock</a></p><script>window.sidebarCurrent = {name: 'MessageStream', ty: 'struct', relpath: ''};</script><script defer src="sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content struct">
<h1 class='fqn'><span class='in-band'>Struct <a href='index.html'>capnp_nonblock</a>::<wbr><a class='struct' href=''>MessageStream</a></span><span class='out-of-band'><span id='render-detail'>
            <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                [<span class='inner'>&#x2212;</span>]
            </a>
        </span><a id='src-114' class='srclink' href='../src/capnp_nonblock/lib.rs.html#65-96' title='goto source code'>[src]</a></span></h1>
<pre class='rust struct'>pub struct MessageStream&lt;S, A = <a class='struct' href='../capnp/message/struct.HeapAllocator.html' title='capnp::message::HeapAllocator'>HeapAllocator</a>, M = <a class='struct' href='../capnp/message/struct.Builder.html' title='capnp::message::Builder'>Builder</a>&lt;A&gt;&gt; {
    // some fields omitted
}</pre><div class='docblock'><p>A <code>MessageStream</code> wraps a stream, and provides methods to read and write
Cap&#39;n Proto messages to the stream. <code>MessageStream</code> performs its own
internal buffering, so the provided stream need not be buffered.</p>

<p>If the underlying stream is non-blocking, <code>MessageStream</code> will automatically
pause reading and writing messages, and will resume during the next call to
<code>read_message</code> or <code>write</code>.</p>

<p><code>MessageStream</code> attempts to reduce the number of required allocations when
reading messages by allocating memory in large chunks, which it loans out to
messages via reference counting. The reference counting is not thread safe,
so messages read by <code>MessageStream</code> may not be sent or shared across thread
boundaries.</p>
</div><h2 id='methods'>Methods</h2><h3 class='impl'><code>impl&lt;S, M, A&gt; <a class='struct' href='../capnp_nonblock/struct.MessageStream.html' title='capnp_nonblock::MessageStream'>MessageStream</a>&lt;S, M, A&gt;</code></h3><div class='impl-items'><h4 id='method.new' class='method'><code>fn <a href='#method.new' class='fnname'>new</a>(inner: S, options: <a class='struct' href='../capnp/message/struct.ReaderOptions.html' title='capnp::message::ReaderOptions'>ReaderOptions</a>) -&gt; <a class='struct' href='../capnp_nonblock/struct.MessageStream.html' title='capnp_nonblock::MessageStream'>MessageStream</a>&lt;S, M, A&gt;</code></h4>
<div class='docblock'><p>Creates a new <code>MessageStream</code> instance wrapping the provided stream, and
with the provided reader options.</p>
</div><h4 id='method.outbound_queue_len' class='method'><code>fn <a href='#method.outbound_queue_len' class='fnname'>outbound_queue_len</a>(&amp;self) -&gt; <a class='primitive' href='https://doc.rust-lang.org/nightly/std/primitive.usize.html'>usize</a></code></h4>
<div class='docblock'><p>Returns the number of queued outbound messages.</p>
</div><h4 id='method.clear_outbound_queue' class='method'><code>fn <a href='#method.clear_outbound_queue' class='fnname'>clear_outbound_queue</a>(&amp;mut self)</code></h4>
<div class='docblock'><p>Clears the outbound message queue of all messages that have not begun
writing yet.</p>
</div><h4 id='method.inner_mut' class='method'><code>fn <a href='#method.inner_mut' class='fnname'>inner_mut</a>(&amp;mut self) -&gt; &amp;mut S</code></h4>
<div class='docblock'><p>Returns the inner stream.</p>
</div><h4 id='method.inner' class='method'><code>fn <a href='#method.inner' class='fnname'>inner</a>(&amp;self) -&gt; &amp;S</code></h4>
<div class='docblock'><p>Returns the inner stream.</p>
</div></div><h3 class='impl'><code>impl&lt;S, M, A&gt; <a class='struct' href='../capnp_nonblock/struct.MessageStream.html' title='capnp_nonblock::MessageStream'>MessageStream</a>&lt;S, M, A&gt; <span class='where'>where S: <a class='trait' href='https://doc.rust-lang.org/nightly/std/io/trait.Read.html' title='std::io::Read'>Read</a></span></code></h3><div class='impl-items'><h4 id='method.read_message' class='method'><code>fn <a href='#method.read_message' class='fnname'>read_message</a>(&amp;mut self) -&gt; <a class='type' href='../capnp/type.Result.html' title='capnp::Result'>Result</a>&lt;<a class='enum' href='https://doc.rust-lang.org/nightly/core/option/enum.Option.html' title='core::option::Option'>Option</a>&lt;<a class='struct' href='../capnp/message/struct.Reader.html' title='capnp::message::Reader'>Reader</a>&lt;<a class='struct' href='../capnp_nonblock/struct.Segments.html' title='capnp_nonblock::Segments'>Segments</a>&gt;&gt;&gt;</code></h4>
<div class='docblock'><p>Returns the next message from the stream, or <code>None</code> if the entire
message is not yet available.</p>

<p>If an <code>Err</code> result is returned, then the stream must be considered
corrupt, and <code>read_message</code> must not be called again.</p>
</div></div><h3 class='impl'><code>impl&lt;S, A, M&gt; <a class='struct' href='../capnp_nonblock/struct.MessageStream.html' title='capnp_nonblock::MessageStream'>MessageStream</a>&lt;S, A, M&gt; <span class='where'>where S: <a class='trait' href='https://doc.rust-lang.org/nightly/std/io/trait.Write.html' title='std::io::Write'>Write</a>, M: <a class='trait' href='https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html' title='core::borrow::Borrow'>Borrow</a>&lt;<a class='struct' href='../capnp/message/struct.Builder.html' title='capnp::message::Builder'>Builder</a>&lt;A&gt;&gt;, A: <a class='trait' href='../capnp/message/trait.Allocator.html' title='capnp::message::Allocator'>Allocator</a></span></code></h3><div class='impl-items'><h4 id='method.write' class='method'><code>fn <a href='#method.write' class='fnname'>write</a>(&amp;mut self) -&gt; <a class='type' href='https://doc.rust-lang.org/nightly/std/io/error/type.Result.html' title='std::io::error::Result'>Result</a>&lt;<a class='primitive' href='https://doc.rust-lang.org/nightly/std/primitive.tuple.html'>()</a>&gt;</code></h4>
<div class='docblock'><p>Writes queued messages to the stream. This should be called when the
stream is in non-blocking mode and writable.</p>

<p>If an <code>Err</code> result is returned, then the stream must be considered
corrupt, and <code>write</code> or <code>write_message</code> must not be called again.</p>
</div><h4 id='method.write_message' class='method'><code>fn <a href='#method.write_message' class='fnname'>write_message</a>(&amp;mut self, message: M) -&gt; <a class='type' href='https://doc.rust-lang.org/nightly/std/io/error/type.Result.html' title='std::io::error::Result'>Result</a>&lt;<a class='primitive' href='https://doc.rust-lang.org/nightly/std/primitive.tuple.html'>()</a>&gt;</code></h4>
<div class='docblock'><p>Queue message for write.</p>

<p>This method optimistically begins writing to the stream if there is no
message currently being written. This is necessary for the blocking
stream case, and efficient in the non-blocking case as well, since it is
likely that the stream is writable.</p>

<p>If an <code>Err</code> result is returned, then the stream must be considered
corrupt, and <code>write</code> or <code>write_message</code> must not be called again.</p>
</div></div><h2 id='implementations'>Trait Implementations</h2><h3 class='impl'><code>impl&lt;S, A, M&gt; <a class='trait' href='https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html' title='core::fmt::Debug'>Debug</a> for <a class='struct' href='../capnp_nonblock/struct.MessageStream.html' title='capnp_nonblock::MessageStream'>MessageStream</a>&lt;S, A, M&gt; <span class='where'>where S: <a class='trait' href='https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html' title='core::fmt::Debug'>Debug</a></span></code></h3><div class='impl-items'><h4 id='method.fmt' class='method'><code>fn <a href='https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html#method.fmt' class='fnname'>fmt</a>(&amp;self, f: &amp;mut <a class='struct' href='https://doc.rust-lang.org/nightly/core/fmt/struct.Formatter.html' title='core::fmt::Formatter'>Formatter</a>) -&gt; <a class='type' href='https://doc.rust-lang.org/nightly/core/fmt/type.Result.html' title='core::fmt::Result'>Result</a></code></h4>
</div></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "capnp_nonblock";
        window.playgroundUrl = "";
    </script>
    <script src="../jquery.js"></script>
    <script src="../main.js"></script>
    
    <script async src="../search-index.js"></script>
</body>
</html>